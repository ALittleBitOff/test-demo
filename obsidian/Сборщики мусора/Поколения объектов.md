[[Процесс]]
#### Что такое поколения объектов?

Для оптимизации сборки мусора память кучи дополнительно разделена на четыре области. В эти области объекты помещаются в зависимости от их возраста (как долго они используются в приложении).

1. **Young Generation (молодое поколение)**. Здесь создаются новые объекты. Область young generation разделена на три части раздела: Eden (Эдем), S0 и S1 (Survivor Space — область для выживших).
    
2. **Old Generation (старое поколение)**. Здесь хранятся давно живущие объекты.
    

![Поколения в куче](https://habrastorage.org/r/w1560/getpro/habr/upload_files/630/451/753/630451753794dc679fbacb89ce108691.png "Поколения в куче")

Поколения в куче

#### Что такое Stop the World?

Когда запускается этап mark, работа приложения останавливается. После завершения mark приложение возобновляет свою работу. Любая сборка мусора — это "Stop the World".

#### Что такое гипотеза о поколениях?

Как уже упоминалось ранее, для оптимизации этапов mark и sweep используются поколения. Гипотеза о поколениях говорит о следующем:

1. Большинство объектов живут недолго.
    
2. Если объект выживает, то он, скорее всего, будет жить вечно.
    
3. Этапы mark и sweep занимают меньше времени при большом количестве мусора. То есть маркировка будет происходить быстрее, если анализируемая область небольшая и в ней много мертвых объектов.
    

Таким образом, алгоритм сборки мусора, использующий поколения, выглядит следующим образом:

![Сборка мусора поколениями](https://habrastorage.org/r/w1560/getpro/habr/upload_files/d8b/a3f/a48/d8ba3fa48616085ab2b5d79dfde43d71.png "Сборка мусора поколениями")

Сборка мусора поколениями

1. Новые объекты создаются в области Eden. Области Survivor (S0, S1) на данный момент пустые.
    
2. Когда область Eden заполняется, происходит **минорная сборка мусора (Minor GC)**. Minor GC — это процесс, при котором операции mark и sweep выполняются для young generation (молодого поколения).
    
3. После Minor GC живые объекты перемещаются в одну из областей Survivor (например, S0). Мертвые объекты полностью удаляются.
    
4. По мере работы приложения пространство Eden заполняется новыми объектами. При очередном Minor GC области young generation и S0 очищаются. На этот раз выжившие объекты перемещаются в область S1, и их возраст увеличивается (отметка о том, что они пережили сборку мусора).
    
5. При следующем Minor GC процесс повторяется. Однако на этот раз области Survivor меняются местами. Живые объекты перемещаются в S0 и у них увеличивается возраст. Области Eden и S1 очищаются.
    
6. Объекты между областями Survivor копируются определенное количество раз (пока не переживут определенное количество Minor GC) или пока там достаточно места. Затем эти объекты копируются в область Old.
    
7. Major GC. При **Major GC** этапы mark и sweep выполняются для Old Generation. Major GC работает медленнее по сравнению с Minor GC, поскольку старое поколение в основном состоит из живых объектов.
    

#### Преимущества использования поколений

Minor GC происходит в меньшей части кучи (~ 2/3 от кучи). Этап маркировки эффективен, потому что область небольшая и состоит в основном из мертвых объектов.

#### Недостатки использования поколений

В каждый момент времени одно из пространств Survivor (S0 или S1) пустое и не используется.